<div class="l-container t-margin-large t-margin-top">

  <div class="l-container l-container-mobile">

    <div class="t-margin-small t-margin-bottom">
      <!--{{render '@m-buttontext&#45;&#45;with-icon'}}-->
      <button class="m-buttonText" (click)="handleClickCancel()">
          <span class="m-buttonText-x-icon">
              <svg class="t-icon" aria-hidden="true">
                  <use xlink:href="/assets/images/svg-defs.svg#icon-dismiss"></use>
              </svg>
          </span>
        <span class="m-buttonText-x-text">Back</span>
      </button>
    </div>

    <!--{{render '@listheading'}}-->
    <div class="l-container l-container-mobile t-margin-medium t-margin-bottom">
      <h2 class="t-type-heading1 t-margin-small t-margin-bottom">Batch Import</h2>
      <p class="t-type-bodyLarge t-color-text3">
        <span class="t-type-bodyLargeBold t-color-text1">Step {{currentStep}}:</span> {{stepName(currentStep)}}
      </p>
    </div>

  </div>

  <div class="t-margin-medium t-margin-bottom">
    <div *ngIf="!isUploadStep()" class="l-container l-container-mobile t-margin-medium t-margin-bottom">
      <!--{{render '@m-fileupload'}}-->
      <div class="m-fileUpload">
        <label for="file-upload">
            <span class="m-fileUpload-x-fileLabel">
              <span class="m-fileUpload-x-icon">
                <svg class="t-icon" aria-hidden="true">
                  <use xlink:href="/assets/images/svg-defs.svg#icon-doc"></use>
                </svg>
              </span>
              <span class="m-fileUpload-x-fileText">File: {{uploadedFile}}</span>
            </span>
          <span class="m-fileUpload-x-actionText">Change File</span>
        </label>

        <input class="t-visuallyHidden" type="file" (change)="handleFileChange($event)" id="file-upload">
      </div>
    </div>


    <!-- STEP 1: Upload File -->
    <ng-template [ngIf]="isUploadStep()">
      <div class="m-dragDrop" [class.m-dragDrop-is-error]="uploadedFileError">
        <label for="dragdrop">
          <span class="m-dragDrop-x-spinner"></span>
          <span class="m-dragDrop-x-icon">
            <!--{{render '@m-countericon'}}-->
            <div class="m-counterIcon">
              <div class="m-iconWithFrame">
                  <svg class="t-icon" aria-hidden="true">
                      <use xlink:href="/assets/images/svg-defs.svg#icon-doc"></use>
                  </svg>
              </div>
              <div class="m-counterIcon-x-counter">
                  <div class="m-counter"><span>{{uploadedFileCount}}</span></div>
              </div>
            </div>
          </span>
          <span class="m-dragDrop-x-message" *ngIf="uploadedFile">{{uploadedFile}}</span>
          <span class="m-dragDrop-x-label" *ngIf="!uploadedFile">Drag and drop your CSV file, or <span class="m-dragtdrop-x-labelInteractive">Select a file to upload</span></span>
          <span class="m-dragDrop-x-label" *ngIf="uploadedFile"><span class="m-dragtdrop-x-labelInteractive">Change file</span></span>
        </label>
        <input class="t-visuallyHidden" type="file" (change)="handleFileChange($event)" id="dragdrop">
      </div>
    </ng-template>

    <!-- STEP 2: Map Fields -->
    <ng-template [ngIf]="isMappingStep()">

      <div class="l-container l-container-mobileMedium t-margin-medium t-margin-bottom">
        <div class="t-margin-medium t-margin-bottom">
          <h3 class="t-type-bodyLargeBold t-color-text1 t-margin-extraSmall t-margin-bottom">{{recordCount}} records total</h3>
          <p class="t-color-text1">Properties have been mapped from the CSV file as shown. Correct any errors and map any undetected fields.</p>
        </div>

        <div *ngIf="hasMappingError" class="l-container t-margin-medium">
          <div class="m-inlineMessage m-inlineMessage-error">
            <div class="m-inlineMessage-x-icon">
              <svg class="t-icon" aria-hidden="true">
                <use xlink:href="/assets/images/svg-defs.svg#icon-error"></use>
              </svg>
            </div>
            <div class="m-inlineMessage-x-title">You've mapped multiple properties to {{duplicateFieldNames()}} which can accept only one.</div>
            <div class="m-inlineMessage-x-message">Update your selections before continuing.</div>
          </div>
        </div>

        <app-accordian closedLabel="Property Definitions" openLabel="Property Definitions">
          <div class="m-skillBackground l-inset t-margin-small t-margin-top">
            field info...
          </div>
        </app-accordian>

      </div>

      <div class="l-container l-container-mobileMedium t-margin-medium t-margin-bottom">
        <app-field-mapping-table
          [uploadedHeaders]="uploadedHeaders()"
          (fieldMappingChanged)="handleMappingChanged($event)"
        ></app-field-mapping-table>
      </div>
    </ng-template>

    <!-- STEP 3: Review -->
    <ng-template [ngIf]="isReviewStep()">
      <div class="l-container l-container-mobileMedium t-margin-medium t-margin-bottom">
        <div class="t-margin-medium t-margin-bottom">
          <h3 class="t-type-bodyLargeBold t-color-text1 t-margin-extraSmall t-margin-bottom">Validation results</h3>
          <p class="t-color-text1">{{recordCount}} RSDs are ready to import.</p>
        </div>

        <app-import-preview-table [skills]="skillsFromResults()"></app-import-preview-table>



      </div>
    </ng-template>

    <!-- Step 4: Success -->
    <ng-template [ngIf]="isSuccessStep()">
      <p>success step goes here...</p>
    </ng-template>
  </div>

  <div class="l-container l-container-mobile">
    <!--{{render '@l-submit&#45;&#45;with-twomain'}}-->
    <div *ngIf="!isSuccessStep()" class="l-submit">
      <button class="m-button" [attr.disabled]="!isStepValid() ? '' : null" (click)="handleClickNext()">
        <span class="m-button-x-text">{{nextButtonLabel}}</span>
      </button>
      <button class="m-button m-button-tertiary" (click)="handleClickCancel()">
        <span class="m-button-x-text">{{cancelButtonLabel}}</span>
      </button>
    </div>

    <div *ngIf="isSuccessStep()" class="l-submit">
      <button class="m-button" (click)="resetState()">
        <span class="m-button-x-text">Import More RSDs</span>
      </button>
      <button class="m-button" routerLink="/skills">
        <span class="m-button-x-text">View RSD Library</span>
      </button>
    </div>
  </div>

</div>
