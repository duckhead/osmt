pipeline {
  agent { label 'master' }
  environment {
    gitRepository = 'ssh://git@github.com:concentricsky/wgu-osmt.git'
    projectName = 'osmt'
  }

  stages {
    stage('Checkout') {
      steps {
        deleteDir()
        checkout scm
      }
    }

    stage("Build") {
      steps {
        sh "docker build . -t client-test -f jenkins-ci/Dockerfile.front"
        sh "docker build . -t api-test -f jenkins-ci/Dockerfile.back"
      }
    }

    stage('Front end tests') {
      steps {
        sh "docker run --rm client-test"
      }
    }

    stage("Back end tests") {
      steps {
        sh "docker run --rm api-test"
      }
    }
  }
  
  post {
    always {
      sh "docker rmi client-test"
      sh "docker rmi api-test"
    }
  }
}